From b782ec3edf9c002ed99c3fd1b9f9d7d2d459e72f Mon Sep 17 00:00:00 2001
From: Rafael Pernil <rafaelpernil@uma.es>
Date: Thu, 11 Nov 2021 14:43:59 +0100
Subject: [PATCH] fix: Monto Atlas update bug

---
 .../src/graphql/resolvers/ResourceResolvers.ts                | 4 ++--
 https-graphql-backend/src/utils/resolver-utils.ts             | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/https-graphql-backend/src/graphql/resolvers/ResourceResolvers.ts b/https-graphql-backend/src/graphql/resolvers/ResourceResolvers.ts
index d701fab..000cc8b 100644
--- a/https-graphql-backend/src/graphql/resolvers/ResourceResolvers.ts
+++ b/https-graphql-backend/src/graphql/resolvers/ResourceResolvers.ts
@@ -17,10 +17,10 @@ export const ResourceResolvers: Resolvers = {
 
 
             const myCurrentTicket = await db.collection<ResourceDbObject>(RESOURCES).find({
-                "tickets.user._id": context.user._id,
                 "tickets.statuses.statusCode": {
                     $ne: TicketStatusCode.Revoked
-                }
+                },
+                "tickets.user._id": context.user._id
             }, {
                 projection: {
                     "tickets.$": 1,
diff --git a/https-graphql-backend/src/utils/resolver-utils.ts b/https-graphql-backend/src/utils/resolver-utils.ts
index 5cca595..552ef63 100644
--- a/https-graphql-backend/src/utils/resolver-utils.ts
+++ b/https-graphql-backend/src/utils/resolver-utils.ts
@@ -13,10 +13,10 @@ async function getUserTicket(userId: string | ObjectId, resourceId: string, db:
 
     const [userTikcet] = await db.collection<ResourceDbObject>(RESOURCES).find({
         _id: parsedResourceId,
-        "tickets.user._id": parsedUserId,
         "tickets.statuses.statusCode": {
             $ne: TicketStatusCode.Revoked
-        }
+        },
+        "tickets.user._id": parsedUserId
     }, {
         projection: {
             "tickets.$": 1,
-- 
2.21.0.windows.1

